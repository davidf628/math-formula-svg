
<!DOCTYPE html>
<html lang="en-US">

<head>

    <title>Line Chart Creator</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" >
    <link rel="stylesheet" href="./style.css">

    <script src="d3.js"></script>

</head>

<body>
    <svg></svg>
</body>

<script>

    let opt = {
        width: 500,
        height: 400,
        color: '#0000CC',
        chart_title: {
            visible: true,
            text: 'Cumulative Frequency for Monthly Rent',
            font: 'Helvetica',
            size: '20px',
            weight: 'bold',
            color: 'black',
            pad: 10
        },
        x_title: {
            visible: true,
            text: 'Monthly Rent ($)',
            font: 'Helvetica',
            size: '12px',
            weight: 'normal',
            color: 'black',
            pad: 10
        },
        y_title: {
            visible: true,
            text: 'Cumulative Frequency',
            font: 'Helvetica',
            size: '20px',
            weight: 'normal',
            color: 'black',
            pad: 50
        },
        show_x_labels: false,
        show_y_labels: false,
        scale_pad: {
            x_low: 0,
            y_low: 0,
            x_high: 300,
            y_high: 4,
        }
    }

    const data = [
        [192, 0], [(350+664)/2, 4], [(665+979)/2,12], [(980+1294)/2,17],
        [(1295+1609)/2, 23], [(1610+1924)/2, 23], [(1925+2239)/2, 23],
        [(2240+2554)/2, 24]
    ];

    // Set up margin and dimensions
    let svg = d3.select('svg')
        .attr('width', opt.width)
        .attr('height', opt.height);

    let chart_area = svg
        .append('g')
        .attr('id', 'chart-area')
        //.attr("transform", `translate(${opt.left_margin},${opt.top_margin})`);

    // Set up fonts first in order to get metrics
    let chart_title = d3.select('svg')
        .append('text')
        .attr('id', 'chart-title')
        .style('font-family', opt.chart_title.font)
        .style('font-size', opt.chart_title.size)
        .style('font-weight', opt.chart_title.weight)
        .text(opt.chart_title.text);
    opt.chart_title.bounds = document.getElementById('chart-title').getBBox();

    let x_axis_title = d3.select('svg')
        .append('text')
        .attr('id', 'x-axis-title')
        .style('font-family', opt.x_title.font)
        .style('font-size', opt.x_title.size)
        .style('font-weight', opt.x_title.weight)
        .text(opt.x_title.text);
    opt.x_title.bounds = document.getElementById('x-axis-title').getBBox();

    let y_axis_title = d3.select('svg')
        .append('text')
        .attr('id', 'y-axis-title')
        .style('font-family', opt.y_title.font)
        .style('font-size', opt.y_title.size)
        .style('font-weight', opt.y_title.weight)
        .text(opt.y_title.text);
    opt.y_title.bounds = document.getElementById('y-axis-title').getBBox();
    console.log(opt.y_title.bounds);

    // Create x scale
    let xScale = d3.scaleLinear()
        .domain( [opt.scale_pad.x_low, d3.max(data, (d, i) => d[0]) + opt.scale_pad.x_high] )
        //.range([0, width])

    // Create y scale
    let yScale = d3.scaleLinear()
        .domain( [opt.scale_pad.y_low, d3.max(data, (d, i) => d[1]) + opt.scale_pad.y_high] )
        //.range([height, 0]); 

    // Add x-axis
    let x_axis = chart_area.append('g')
        .attr('id', 'x-axis')
        //.attr('transform', `translate(0,${height})`)
        .call(d3.axisBottom(xScale));
            
    // Add y-axis        
    let y_axis = chart_area.append('g')
        .attr('id', 'y-axis')
        .call(d3.axisLeft(yScale));

    let x_axis_height = document.getElementById('x-axis').getBBox().height;
    let y_axis_width = document.getElementById('y-axis').getBBox().width;

    // Calculate margins
    opt.top_margin = opt.chart_title.pad * 2 + opt.chart_title.bounds.height;
    opt.right_margin = 20;
    opt.left_margin = opt.y_title.pad * 2 + opt.y_title.bounds.height + y_axis_width;
    opt.bottom_margin = opt.x_title.pad * 2 + opt.x_title.bounds.height + x_axis_height;

    // Dimensions of the chart
    const width = svg.attr("width") - opt.left_margin - opt.right_margin;
    const height = svg.attr("height") - opt.top_margin - opt.bottom_margin;

    svg.append("line")
        .attr("x1", opt.y_title.bounds.height + opt.y_title.pad)  
        .attr("y1", opt.top_margin)
        .attr("x2", opt.y_title.bounds.height + opt.y_title.pad)
        .attr("y2", opt.top_margin + height)
        .style("stroke-width", 1)
        .style("stroke", "red")
        .style("fill", "none");

    svg.append("line")
        .attr("x1", 0)  
        .attr("y1", opt.top_margin)
        .attr("x2", opt.y_title.pad)
        .attr("y2", opt.top_margin)
        .style("stroke-width", 1)
        .style("stroke", "red")
        .style("fill", "none");

    svg.append("line")
        .attr("x1", opt.y_title.pad + opt.y_title.bounds.height)  
        .attr("y1", opt.top_margin)
        .attr("x2", opt.left_margin)
        .attr("y2", opt.top_margin)
        .style("stroke-width", 1)
        .style("stroke", "red")
        .style("fill", "none");

    svg.append("line")
        .attr("x1", opt.y_title.pad)  
        .attr("y1", opt.top_margin)
        .attr("x2", opt.y_title.pad)
        .attr("y2", opt.top_margin + height)
        .style("stroke-width", 1)
        .style("stroke", "red")
        .style("fill", "none");

    svg.append("line")
        .attr("x1", (opt.left_margin - y_axis_width)/2)  
        .attr("y1", opt.top_margin)
        .attr("x2", (opt.left_margin - y_axis_width)/2)
        .attr("y2", opt.top_margin + height)
        .style("stroke-width", 1)
        .style("stroke", "blue")
        .style("fill", "none");
    
    svg.append("rect")
        .attr('x', 0)
        .attr('y', opt.top_margin)
        .attr('width', opt.left_margin - y_axis_width)
        .attr('height', height)
        .attr('fill', '#002200')
        .attr('fill-opacity', 0.1)
        .attr('stroke', 'blue')

    chart_area.attr("transform", `translate(${opt.left_margin},${opt.top_margin})`);
    xScale.range([0, width]);
    yScale.range([height, 0]);

    // Redraw the axes, now that we know the dimensions
    x_axis
        .attr('transform', `translate(0,${height})`)
        .call(d3.axisBottom(xScale));

    y_axis
        .call(d3.axisLeft(yScale));

    // Next, reposition the labels
    chart_title
        .attr('x', width/2 + opt.left_margin)
        .attr('y',opt.chart_title.pad + opt.chart_title.bounds.height/2)
        .attr('text-anchor', 'middle')
        .attr('fill', opt.chart_title.color)
            
    // X label
    x_axis_title
        .attr('x', width/2 + opt.left_margin)
        .attr('y', opt.top_margin + height + x_axis_height + opt.x_title.pad + opt.x_title.bounds.height/2)
        .attr('text-anchor', 'middle')
            
    // Y label
    y_axis_title
        .attr('text-anchor', 'middle')
        .attr('dominant-baseline', 'middle')
        .attr('transform',`translate(${opt.y_title.bounds.height/2 + opt.y_title.pad}, ${height/2 + opt.top_margin})rotate(-90)`)
            
    // Add dots
    svg.append('g')
        .selectAll('dot')
        .data(data)
        .enter()
        .append('circle')
        .attr('cx', (d,i) => xScale(d[0]) )
        .attr('cy', (d,i) => yScale(d[1]) )
        .attr('r', 3)
        .attr('transform', `translate(${opt.left_margin},${opt.top_margin})`)
        .style('fill', opt.color);
    
    // Add Lines     
    let line = d3.line()
        .x( (d,i) => xScale(d[0]) ) 
        .y( (d,i) => yScale(d[1]) ) 
            
    svg.append('path')
        .datum(data) 
        .attr('class', 'line') 
        .attr('transform', `translate(${opt.left_margin},${opt.top_margin})`)
        .attr('d', line)
        .style('fill', 'none')
        .style('stroke', opt.color)
        .style('stroke-width', '2');
      
</script>

</html>
